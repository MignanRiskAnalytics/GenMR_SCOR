

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial 1: Generating a virtual environment for the GenMR digital template &mdash; GenMR 1.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=58fbf978"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Reference manual" href="../manual.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            GenMR
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../rationale.html">Rationale</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../rationale.html#compound-events">Compound events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rationale.html#generic-multi-risk-genmr-framework">Generic Multi-Risk (GenMR) framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../rationale.html#past-developments">Past developments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rationale.html#new-developments">New developments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../rationale.html#digital-template">Digital Template</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../rationale.html#id18">Past developments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../rationale.html#id26">New developments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../rationale.html#tutorials">Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rationale.html#how-to-guides">How-to guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rationale.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../manual.html">Reference manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../manual.html#module-GenMR.environment">GenMR.environment module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#genmr-virtual-environment-generator">GenMR Virtual Environment Generator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#layers-and-related-objects-v1-1-1">Layers and Related Objects (v1.1.1)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#planned-additions-v1-1-2">Planned Additions (v1.1.2)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_natLand"><code class="docutils literal notranslate"><span class="pre">EnvLayer_natLand</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_soil"><code class="docutils literal notranslate"><span class="pre">EnvLayer_soil</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_soil.FS_state"><code class="docutils literal notranslate"><span class="pre">EnvLayer_soil.FS_state</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_soil.FS_value"><code class="docutils literal notranslate"><span class="pre">EnvLayer_soil.FS_value</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_soil.wetness"><code class="docutils literal notranslate"><span class="pre">EnvLayer_soil.wetness</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_topo"><code class="docutils literal notranslate"><span class="pre">EnvLayer_topo</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_topo.algo_diamondsquare"><code class="docutils literal notranslate"><span class="pre">EnvLayer_topo.algo_diamondsquare()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_topo.aspect"><code class="docutils literal notranslate"><span class="pre">EnvLayer_topo.aspect</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_topo.coastline_coord"><code class="docutils literal notranslate"><span class="pre">EnvLayer_topo.coastline_coord</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_topo.model_cs_compoundbevel"><code class="docutils literal notranslate"><span class="pre">EnvLayer_topo.model_cs_compoundbevel()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_topo.model_fr_diamondsquare"><code class="docutils literal notranslate"><span class="pre">EnvLayer_topo.model_fr_diamondsquare()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_topo.model_rv_dampedsine"><code class="docutils literal notranslate"><span class="pre">EnvLayer_topo.model_rv_dampedsine()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_topo.model_th_ellipsoid"><code class="docutils literal notranslate"><span class="pre">EnvLayer_topo.model_th_ellipsoid()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_topo.model_vo_cone"><code class="docutils literal notranslate"><span class="pre">EnvLayer_topo.model_vo_cone()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_topo.river_coord"><code class="docutils literal notranslate"><span class="pre">EnvLayer_topo.river_coord</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_topo.slope"><code class="docutils literal notranslate"><span class="pre">EnvLayer_topo.slope</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_urbLand"><code class="docutils literal notranslate"><span class="pre">EnvLayer_urbLand</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_urbLand.bldg_roofpitch"><code class="docutils literal notranslate"><span class="pre">EnvLayer_urbLand.bldg_roofpitch</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_urbLand.bldg_type"><code class="docutils literal notranslate"><span class="pre">EnvLayer_urbLand.bldg_type</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_urbLand.bldg_value"><code class="docutils literal notranslate"><span class="pre">EnvLayer_urbLand.bldg_value</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_urbLand.calc_Pr_urbanise"><code class="docutils literal notranslate"><span class="pre">EnvLayer_urbLand.calc_Pr_urbanise()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_urbLand.get_S_urban"><code class="docutils literal notranslate"><span class="pre">EnvLayer_urbLand.get_S_urban()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_urbLand.get_d4mkd"><code class="docutils literal notranslate"><span class="pre">EnvLayer_urbLand.get_d4mkd()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_urbLand.get_state_built"><code class="docutils literal notranslate"><span class="pre">EnvLayer_urbLand.get_state_built()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_urbLand.infiltration"><code class="docutils literal notranslate"><span class="pre">EnvLayer_urbLand.infiltration</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_urbLand.roadNet_coord"><code class="docutils literal notranslate"><span class="pre">EnvLayer_urbLand.roadNet_coord</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.EnvLayer_urbLand.transform_landUse"><code class="docutils literal notranslate"><span class="pre">EnvLayer_urbLand.transform_landUse()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.environment.EnvObj_roadNetwork"><code class="docutils literal notranslate"><span class="pre">EnvObj_roadNetwork</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.environment.RasterGrid"><code class="docutils literal notranslate"><span class="pre">RasterGrid</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.environment.Src"><code class="docutils literal notranslate"><span class="pre">Src</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.Src.EQ_char"><code class="docutils literal notranslate"><span class="pre">Src.EQ_char</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../manual.html#GenMR.environment.Src.get_char_srcLine"><code class="docutils literal notranslate"><span class="pre">Src.get_char_srcLine()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.environment.calc_FS"><code class="docutils literal notranslate"><span class="pre">calc_FS()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.environment.calc_coord_river_dampedsine"><code class="docutils literal notranslate"><span class="pre">calc_coord_river_dampedsine()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.environment.calc_topo_attributes"><code class="docutils literal notranslate"><span class="pre">calc_topo_attributes()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.environment.downscale_RasterGrid"><code class="docutils literal notranslate"><span class="pre">downscale_RasterGrid()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.environment.plot_EnvLayer_attr"><code class="docutils literal notranslate"><span class="pre">plot_EnvLayer_attr()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.environment.plot_EnvLayers"><code class="docutils literal notranslate"><span class="pre">plot_EnvLayers()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.environment.plot_src"><code class="docutils literal notranslate"><span class="pre">plot_src()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../manual.html#module-GenMR.utils">GenMR.utils module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#genmr-utility-functions">GenMR Utility Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.add0s_iter"><code class="docutils literal notranslate"><span class="pre">add0s_iter()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.cmap_peril"><code class="docutils literal notranslate"><span class="pre">cmap_peril()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.col_peril"><code class="docutils literal notranslate"><span class="pre">col_peril()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.col_state_h"><code class="docutils literal notranslate"><span class="pre">col_state_h()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.flatten_list"><code class="docutils literal notranslate"><span class="pre">flatten_list()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.get_data"><code class="docutils literal notranslate"><span class="pre">get_data()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.get_neighborhood_ind"><code class="docutils literal notranslate"><span class="pre">get_neighborhood_ind()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.get_net_coord"><code class="docutils literal notranslate"><span class="pre">get_net_coord()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.incrementing"><code class="docutils literal notranslate"><span class="pre">incrementing()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.init_io"><code class="docutils literal notranslate"><span class="pre">init_io()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.load_json2dict"><code class="docutils literal notranslate"><span class="pre">load_json2dict()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.load_pickle2class"><code class="docutils literal notranslate"><span class="pre">load_pickle2class()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.marker_peril"><code class="docutils literal notranslate"><span class="pre">marker_peril()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.norm_z"><code class="docutils literal notranslate"><span class="pre">norm_z</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.partitioning"><code class="docutils literal notranslate"><span class="pre">partitioning()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.pooling"><code class="docutils literal notranslate"><span class="pre">pooling()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.save_class2pickle"><code class="docutils literal notranslate"><span class="pre">save_class2pickle()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../manual.html#GenMR.utils.save_dict2json"><code class="docutils literal notranslate"><span class="pre">save_dict2json()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial 1: Environment creation (in construction)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#natural-environment-generation">1. Natural environment generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#grid-definition">1.1. Grid definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#natural-peril-definition-for-environmental-objects">1.2. Natural peril definition (for environmental objects)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generating-the-topography-soil-and-land-layers">1.3. Generating the topography, soil, and land layers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#environmental-layer-properties-and-attribute-plotting">1.4. Environmental layer properties (and attribute plotting)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-note-on-environmental-layer-downscaling">1.5. A note on environmental layer downscaling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#technological-environment-generation">2. Technological environment generation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generating-the-urban-land-layer-and-road-network-object">2.1. Generating the urban land layer (and road network object)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GenMR</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Tutorial 1: Generating a virtual environment for the GenMR digital template</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/Tutorial1_DigitalTemplate_environment.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="tutorial-1-generating-a-virtual-environment-for-the-genmr-digital-template">
<h1>Tutorial 1: Generating a virtual environment for the GenMR digital template<a class="headerlink" href="#tutorial-1-generating-a-virtual-environment-for-the-genmr-digital-template" title="Link to this heading"></a></h1>
<p><strong>Author:</strong> Arnaud Mignan, Mignan Risk Analytics GmbH<br />
<strong>Version:</strong> 0.1<br />
<strong>Last Updated:</strong> 2025-10-27<br />
<strong>License:</strong> AGPL-3</p>
<p>The <em>digital template</em>, first described in <a class="reference external" href="https://www.mdpi.com/1660-4601/19/23/16097">Mignan (2022)</a> and used in the CAT Risk Modelling Sandbox <a class="reference external" href="https://github.com/amignan/Intro2CATriskModelling/blob/main/CATRiskModellingSandbox_tutorial.ipynb">Mignan (2024)</a>, is a microcosm simulation of the complex Earth system for catastrophe dynamics R&amp;D, multi-risk prototyping in the Generic Multi-Risk (GenMR) framework, and catastrophe risk eduction. It is defined as a virtual environment populated by loss-generating events that interact with each other and with the environment. The virtual environment, to be built in this tutorial, is composed of <em>environmental layers</em> that consist of sets of variables <span class="math notranslate nohighlight">\(\theta(x,y)\)</span> defined in a spatial grid of coordinates <span class="math notranslate nohighlight">\((x,y)\)</span>. Each layer may be altered by <em>environmental objects</em> located within the layer. The parsimonious complex Earth system finally consists of a stack of interacting environmental layers defined in the natural, technological and socio-economic systems. The loss-generating events that populate the virtual environment will be defined in the next tutorial, and their occurrence rates and interactions in a third and final tutorial.</p>
<p>Currently, a limited number of environmental layers and objects are available (Fig. 1, Table 1). This notebook provides a concise overview of these layers using a default parameterisation, with alternative scenarios to be introduced later in the How-To Guides. The outputs generated here will serve as input for hazard and risk assessments in the subsequent tutorials.</p>
<p><img alt="" src="../_images/digitaltemplate_env_rayshader.jpg" /></p>
<center><small><b>Fig. 1.</b> Example of the GenMR digital template (default parameterisation) showing the topography and land use layers, with water in blue, built areas in grey, and the road network in white. A soil layer is also included but not displayed. Simulation rendered using <a href='https://www.rayshader.com/' target='_blank'>Rayshader</a> (Morgan-Wall, 2022).</small></center>
<br>
<center><small><b>Tab. 1.</b> List of available environmental layers <code>EnvLayer_ID</code> (Python classes).</small></center>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Environment</p></th>
<th class="head text-left"><p>ID</p></th>
<th class="head text-left"><p>Layer</p></th>
<th class="head text-left"><p>Variables</p></th>
<th class="head text-left"><p>Properties (examples)</p></th>
<th class="head text-left"><p>Object dependencies<span class="math notranslate nohighlight">\(^*\)</span></p></th>
<th class="head text-left"><p>References</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Natural</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">topoLayer</span></code></p></td>
<td class="text-left"><p>Topography</p></td>
<td class="text-left"><p>Elevation <span class="math notranslate nohighlight">\(z\)</span></p></td>
<td class="text-left"><p>Slope, aspect</p></td>
<td class="text-left"><p>Geological &amp; hydrological objects</p></td>
<td class="text-left"><p>Mignan (2022)</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Natural</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">soilLayer</span></code></p></td>
<td class="text-left"><p>Soil</p></td>
<td class="text-left"><p>Depth <span class="math notranslate nohighlight">\(h\)</span></p></td>
<td class="text-left"><p>Factor of safety</p></td>
<td class="text-left"><p>-</p></td>
<td class="text-left"><p>Mignan (2022)</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Natural</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">natLandLayer</span></code></p></td>
<td class="text-left"><p>Natural land</p></td>
<td class="text-left"><p>State <span class="math notranslate nohighlight">\(S\)</span></p></td>
<td class="text-left"><p>-</p></td>
<td class="text-left"><p>-</p></td>
<td class="text-left"><p>Mignan (2024)</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Technological</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">urbLandLayer</span></code></p></td>
<td class="text-left"><p>Urban land</p></td>
<td class="text-left"><p>State <span class="math notranslate nohighlight">\(S\)</span></p></td>
<td class="text-left"><p>Exposure value, year built</p></td>
<td class="text-left"><p>Road network</p></td>
<td class="text-left"><p>Mignan (2024)</p></td>
</tr>
</tbody>
</table>
<center><small>* Each layer additionally depends on the previous ones.</small></center>
<br>
The environmental layers are generated as follows:
<ul class="simple">
<li><p><strong>Topography</strong>: Represented as elevation, <span class="math notranslate nohighlight">\(z\)</span> (m), the generic topography is defined by a west-dipping slope and a fractal dimension between 2 and 3. Environmental objects associated with peril sources modify the topography through intrusion and extrusion rules. The overall process, illustrated in Figure 2, combines methods from solid geometry and morphometry. Further details can be found in <a class="reference external" href="https://www.mdpi.com/1660-4601/19/23/16097">Mignan (2022)</a>. The main properties of the topography layer include terrain slope [<span class="math notranslate nohighlight">\(^\circ\)</span>] and aspect [<span class="math notranslate nohighlight">\(^\circ\)</span>].</p></li>
</ul>
<p><img alt="" src="../_images/ref_Mignan_IJERPH2022_fig2.jpg" /></p>
<center><small><b>Fig. 2.</b> Construction of the topography layer following rules of solid geometry and morphometry, illustrating the combination of geometric primitives and terrain metrics. Redrawn from <a href='https://www.mdpi.com/1660-4601/19/23/16097' target='_blank'>Mignan (2022:fig.2)</a>.</small></center>
<br>
<ul class="simple">
<li><p><strong>Soil</strong>: Characterised by the soil thickness, <span class="math notranslate nohighlight">\(h\)</span> (m), which is initially spatially uniform. It can later vary through mass movement processes (using the landslide cellular automaton (CA) introduced in the next tutorial) or by a simpler rule applied here: <span class="math notranslate nohighlight">\(h = 0\)</span> if the soil is unstable at <span class="math notranslate nohighlight">\((x,y)\)</span>. Other soil properties remain fixed parameters at this stage. A key property of the soil layer is the factor of safety, <span class="math notranslate nohighlight">\(F_S\)</span>, which indicates whether the soil is stable, critical, or unstable.</p></li>
<li><p><strong>Natural land</strong>: Defined by the state <span class="math notranslate nohighlight">\(S\)</span>, with <span class="math notranslate nohighlight">\(S=-1\)</span> for water, <span class="math notranslate nohighlight">\(S=0\)</span> for grassland, and <span class="math notranslate nohighlight">\(S=1\)</span> for forest. These classes represent the pre-urbanised land cover. All grid locations <span class="math notranslate nohighlight">\((x,y)\)</span> are considered forested except those above an elevation-dependent tree line (grassland), or below sea level (<span class="math notranslate nohighlight">\(z = 0\)</span>) and along river channels (water).</p></li>
<li><p><strong>Urban land</strong>: Represents the built environment, where the state <span class="math notranslate nohighlight">\(S\)</span> overwrites the natural land classification: <span class="math notranslate nohighlight">\(S = 2\)</span> for housing, <span class="math notranslate nohighlight">\(S = 3\)</span> for industrial, and <span class="math notranslate nohighlight">\(S = 4\)</span> for commercial areas. The city is generated using a hybrid model that combines the SLEUTH city growth CA (ref), a road network CA (ref), and a land-use transformation function (ref) (see <a class="reference external" href="https://www.cambridge.org/highereducation/books/introduction-to-catastrophe-risk-modelling/A3A5B5FB990921422BFEBB07734BF869#overview">Mignan, 2024</a>, for details; Fig. 3). A key property of the urban-land layer is the asset value per pixel, which serves as the exposure component in the subsequent loss assessment tutorial.</p></li>
</ul>
<p>ADD Fig. 3 - from Mignan (2024)…</p>
<p>Sections 1 and 2 detail the simulation of the virtual natural and technological environments, respectively (v1.1.1). A future Section 3, to be released in v1.1.2, will describe the socio-economic environment of the digital template.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## libraries ##</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>

<span class="c1">#import warnings </span>
<span class="c1">#warnings.filterwarnings(&#39;ignore&#39;)   # commented, try to remove all warnings</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">GenMR</span><span class="w"> </span><span class="kn">import</span> <span class="n">environment</span> <span class="k">as</span> <span class="n">GenMR_env</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">GenMR</span><span class="w"> </span><span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">GenMR_utils</span>

<span class="n">GenMR_utils</span><span class="o">.</span><span class="n">init_io</span><span class="p">()</span>  <span class="c1"># make folders /io and /fig if do not exist</span>
</pre></div>
</div>
</div>
</div>
<section id="natural-environment-generation">
<h2>1. Natural environment generation<a class="headerlink" href="#natural-environment-generation" title="Link to this heading"></a></h2>
<p>The generic natural environment is constrained by a predominant west–east orientation, with a coastline located at <code class="docutils literal notranslate"><span class="pre">x0</span></code>. This configuration ensures that any water mass, when present, is systematically positioned on the western side of the grid (Fig. 1). By convention, rivers flow exclusively from east to west. This directional constraint simplifies the natural environment generator while still allowing it to represent a wide range of regional configurations.</p>
<section id="grid-definition">
<h3>1.1. Grid definition<a class="headerlink" href="#grid-definition" title="Link to this heading"></a></h3>
<p>All environmental layers are defined on the raster grid <code class="docutils literal notranslate"><span class="pre">RasterGrid(par)</span></code>. The default grid parameterisation <code class="docutils literal notranslate"><span class="pre">gridPar</span></code> (a dictionary) specifies an active domain of 100 × 100 km, with a reference north-south coastline fixed at <code class="docutils literal notranslate"><span class="pre">x0</span> <span class="pre">=</span> <span class="pre">0</span></code> (i.e., <span class="math notranslate nohighlight">\(z(x_0) = 0\)</span>). A larger computational domain, bounded by (<code class="docutils literal notranslate"><span class="pre">xmin</span></code>, <code class="docutils literal notranslate"><span class="pre">xmax</span></code>, <code class="docutils literal notranslate"><span class="pre">ymin</span></code>, <code class="docutils literal notranslate"><span class="pre">ymax</span></code>), is included to account for potential boundary effects. The active box is thus defined as (<code class="docutils literal notranslate"><span class="pre">xmin+xbuffer</span></code>, <code class="docutils literal notranslate"><span class="pre">xmax-xbuffer</span></code>, <code class="docutils literal notranslate"><span class="pre">ymin+ybuffer</span></code>, <code class="docutils literal notranslate"><span class="pre">ymax-ybuffer</span></code>). The spatial resolution is determined by the pixel width <code class="docutils literal notranslate"><span class="pre">w=0.1</span></code> km. Lower-resolution grids may be defined later for specific environmental processes. In the current version, the parameter <code class="docutils literal notranslate"><span class="pre">lat_deg</span></code> specifies the latitude at <span class="math notranslate nohighlight">\((x = 0, y = 0)\)</span>, which is used in hurricane size modelling. A <code class="docutils literal notranslate"><span class="pre">lon_deg</span></code> parameter will be added in a future release when a longitude reference becomes necessary for additional environmental processes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gridPar</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="mf">.1</span><span class="p">,</span>
           <span class="s1">&#39;xmin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;x0&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;xmax&#39;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span> <span class="s1">&#39;ymin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;ymax&#39;</span><span class="p">:</span> <span class="mi">110</span><span class="p">,</span>
           <span class="s1">&#39;xbuffer&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;ybuffer&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
           <span class="s1">&#39;lat_deg&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">}</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">GenMR_env</span><span class="o">.</span><span class="n">RasterGrid</span><span class="p">(</span><span class="n">gridPar</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="natural-peril-definition-for-environmental-objects">
<h3>1.2. Natural peril definition (for environmental objects)<a class="headerlink" href="#natural-peril-definition-for-environmental-objects" title="Link to this heading"></a></h3>
<p>Environmental layers can be influenced by specific environmental objects; this is notably the case for the first layer to be generated, the topography. In the context of a generic and parsimonious model, only essential objects are implemented. Consequently, the environmental objects included are restricted to those associated with the perils to be modelled in later stages.</p>
<br>
<center><small><b>Tab. 2.</b> Characteristics of peril sources that generate environmental objects affecting the topography.</small></center>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Peril</p></th>
<th class="head text-left"><p>ID</p></th>
<th class="head text-left"><p>Source</p></th>
<th class="head text-left"><p>Environmental object</p></th>
<th class="head text-left"><p>References</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Earthquake</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">EQ</span></code></p></td>
<td class="text-left"><p>Fault of coordinates (<code class="docutils literal notranslate"><span class="pre">x</span></code>,<code class="docutils literal notranslate"><span class="pre">y</span></code>), width <code class="docutils literal notranslate"><span class="pre">w_km</span></code>, dip <code class="docutils literal notranslate"><span class="pre">dig_deg</span></code>, depth <code class="docutils literal notranslate"><span class="pre">z_km</span></code></p></td>
<td class="text-left"><p>Tectonic hill</p></td>
<td class="text-left"><p>Mignan (2022)</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Fluvial flood</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">FF</span></code></p></td>
<td class="text-left"><p>River modelled as damped sine (<code class="docutils literal notranslate"><span class="pre">riv_A_km</span></code>, <code class="docutils literal notranslate"><span class="pre">riv_lbd</span></code>, <code class="docutils literal notranslate"><span class="pre">riv_ome</span></code>, <code class="docutils literal notranslate"><span class="pre">riv_y0</span></code>), with discharge <code class="docutils literal notranslate"><span class="pre">Q_m3/s</span></code> and implicit upstream catchment area <code class="docutils literal notranslate"><span class="pre">A_km2</span></code></p></td>
<td class="text-left"><p>River valley</p></td>
<td class="text-left"><p>Mignan (2022)</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Volcanic eruption</p></td>
<td class="text-left"><p><code class="docutils literal notranslate"><span class="pre">VE</span></code></p></td>
<td class="text-left"><p>Volcano of coordinates (<code class="docutils literal notranslate"><span class="pre">x</span></code>,<code class="docutils literal notranslate"><span class="pre">y</span></code>)</p></td>
<td class="text-left"><p>Conic volcanic edifice</p></td>
<td class="text-left"><p>Mignan (2022)</p></td>
</tr>
</tbody>
</table>
<p>This configuration is parameterised using the dictionary <code class="docutils literal notranslate"><span class="pre">srcPar</span></code>. In this example, two faults, one river, and one volcano are defined. Additional perils will be introduced in the next tutorial. At this stage, only perils that can modify environmental layers are included.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">srcPar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;perils&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;EQ&#39;</span><span class="p">,</span> <span class="s1">&#39;FF&#39;</span><span class="p">,</span> <span class="s1">&#39;VE&#39;</span><span class="p">],</span>
    <span class="s1">&#39;EQ&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;object&#39;</span><span class="p">:</span> <span class="s1">&#39;fault&#39;</span><span class="p">,</span>
        <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">70</span><span class="p">],</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">60</span><span class="p">]],</span>                                        <span class="c1"># 2 faults (2 segments, 1 segment)</span>
        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">80</span><span class="p">],</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">]],</span>
        <span class="s1">&#39;w_km&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;dip_deg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">45</span><span class="p">,</span> <span class="mi">45</span><span class="p">],</span>
        <span class="s1">&#39;z_km&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;mec&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">],</span>                                    <span class="c1"># only reverse R mechanism for now</span>
        <span class="s1">&#39;bin_km&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>                                                         <span class="c1"># fault spatial resolution</span>
    <span class="s1">&#39;FF&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;object&#39;</span><span class="p">:</span> <span class="s1">&#39;river&#39;</span><span class="p">,</span>
        <span class="s1">&#39;riv_A_km&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="s1">&#39;riv_lbd&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">.03</span><span class="p">],</span> <span class="s1">&#39;riv_ome&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">.1</span><span class="p">],</span> <span class="s1">&#39;riv_y0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">],</span>  <span class="c1"># y = A*exp(-lbd*x)*cos(ome*x)+y0</span>
        <span class="s1">&#39;Q_m3/s&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">100e3</span><span class="p">],</span> <span class="s1">&#39;A_km2&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="o">*</span><span class="mi">100</span><span class="p">},</span>
    <span class="s1">&#39;VE&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;object&#39;</span><span class="p">:</span> <span class="s1">&#39;volcano&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">90</span><span class="p">],</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">90</span><span class="p">]},</span>
<span class="p">}</span>

<span class="n">src</span> <span class="o">=</span> <span class="n">GenMR_env</span><span class="o">.</span><span class="n">Src</span><span class="p">(</span><span class="n">srcPar</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>

<span class="n">GenMR_env</span><span class="o">.</span><span class="n">plot_src</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/53ee9b998c7b2b5f65767d733eaed37ac23cdf5139ffbc2f95d73c6c3bdc49ff.png" src="../_images/53ee9b998c7b2b5f65767d733eaed37ac23cdf5139ffbc2f95d73c6c3bdc49ff.png" />
</div>
</div>
</section>
<section id="generating-the-topography-soil-and-land-layers">
<h3>1.3. Generating the topography, soil, and land layers<a class="headerlink" href="#generating-the-topography-soil-and-land-layers" title="Link to this heading"></a></h3>
<p>Environmental layers are defined as instance of classes <code class="docutils literal notranslate"><span class="pre">EnvLayer_*</span></code> (with <code class="docutils literal notranslate"><span class="pre">*</span></code> the layer ID; see Table 1). For this version of the digital template, parsimonious natural environment models with a minimal number of input parameters are favored for illustration purposes (at the cost of some over-simplifications). A few models will be mentioned below without going into any detail. Visit the reference manual of <code class="docutils literal notranslate"><span class="pre">GenMR_Basic</span></code> for an in-depth description.</p>
<p>The <strong>topography layer</strong> (parameterized in <code class="docutils literal notranslate"><span class="pre">topoPar</span></code>) is defined with the elevation <span class="math notranslate nohighlight">\(z(x,y)\)</span> as its main variable. It is constructed at a lower granularity with pixel width <code class="docutils literal notranslate"><span class="pre">gridPar['w']</span> <span class="pre">*</span> <span class="pre">lores_f</span></code>. The process takes several successive steps:</p>
<ul class="simple">
<li><p>Background <code class="docutils literal notranslate"><span class="pre">bg</span></code>: Plane tilted westward with slope <code class="docutils literal notranslate"><span class="pre">bg_tan(phi)</span></code> anchored at <span class="math notranslate nohighlight">\(z = 0\)</span> at <code class="docutils literal notranslate"><span class="pre">x0</span></code>;</p></li>
<li><p>Tectonic hill(s) <code class="docutils literal notranslate"><span class="pre">th</span></code>: Ellipsoid(s) with axes constrained by the 3D fault segment geometry (with centroid adjustable along the <span class="math notranslate nohighlight">\(z\)</span>-axis by <code class="docutils literal notranslate"><span class="pre">th_Dz_km</span></code>) extruding the topography;</p></li>
<li><p>Volcano(s) <code class="docutils literal notranslate"><span class="pre">vo</span></code>: Cone(s) centered on the volcano coordinates with width <code class="docutils literal notranslate"><span class="pre">vo_w_km</span></code> and height <code class="docutils literal notranslate"><span class="pre">vo_h_km</span></code> extruding the topography;</p></li>
<li><p>Fractal <code class="docutils literal notranslate"><span class="pre">fr</span></code>: Fractal noise (random seed <code class="docutils literal notranslate"><span class="pre">fr_seed</span></code>) with fractal dimension <code class="docutils literal notranslate"><span class="pre">fr_Df</span></code> and overall amplitude a fraction <code class="docutils literal notranslate"><span class="pre">fr_eta</span></code> of the background topography added to the topography. Uses the Diamond-square algorithm (ref). The coastline becomes irregular around <code class="docutils literal notranslate"><span class="pre">x0</span></code> at this step;</p></li>
<li><p>River valley(s) <code class="docutils literal notranslate"><span class="pre">rv</span></code>: Flat flood plain(s) tilted westward with slope <code class="docutils literal notranslate"><span class="pre">rv_tan(phiWE)</span></code> and N-S extend bound by the river exponential envelope intruding the topography (with angle <code class="docutils literal notranslate"><span class="pre">rv_tan(phiNS)</span></code> at the northern and southern boundaries). River channel(s) 2 N-S pixels wide for smooth flow and further intruded for normal channeled flow. Remnants of the original topography remain at a ratio <code class="docutils literal notranslate"><span class="pre">rv_eta</span></code>;</p></li>
<li><p>Coastal strip <code class="docutils literal notranslate"><span class="pre">cs</span></code>: Coastal strip of width <code class="docutils literal notranslate"><span class="pre">cs_w_km</span></code> and slope <code class="docutils literal notranslate"><span class="pre">cs_tan(phi)</span></code> (&lt; <code class="docutils literal notranslate"><span class="pre">bg_tan(phi)</span></code>) intruding the topography on the eastern side of the coastline. Remnants of the original topography remain at a ratio <code class="docutils literal notranslate"><span class="pre">cs_eta</span></code>.</p></li>
</ul>
<p>At the end of the process, the layer is upscaled back to the default pixel width <code class="docutils literal notranslate"><span class="pre">gridPar['w']</span></code>. Except for the background topography, all other alterations are optional (<code class="docutils literal notranslate"><span class="pre">th</span></code>, <code class="docutils literal notranslate"><span class="pre">vo</span></code>, <code class="docutils literal notranslate"><span class="pre">fr</span></code>, <code class="docutils literal notranslate"><span class="pre">rv</span></code>, <code class="docutils literal notranslate"><span class="pre">cs</span></code> true or false).</p>
<p>The <strong>soil layer</strong> (parameterized in <code class="docutils literal notranslate"><span class="pre">soilPar</span></code>) is defined by two main variables, the soil thickness <span class="math notranslate nohighlight">\(h(x,y)\)</span>, initialised at constant value <code class="docutils literal notranslate"><span class="pre">h0_m</span></code>, and the water column depth <span class="math notranslate nohighlight">\(h_w(x,y)\)</span>, initialized at <code class="docutils literal notranslate"><span class="pre">wat_h_m</span></code>. In the current version, soil parameters are kept constant (effective cohesion <code class="docutils literal notranslate"><span class="pre">Ceff_Pa</span></code>, effective friction angle <code class="docutils literal notranslate"><span class="pre">phieff_deg</span></code> and soil density <code class="docutils literal notranslate"><span class="pre">rho_kg/m3</span></code>). <span class="math notranslate nohighlight">\(h(x,y)\)</span> is then updated with the method defined in <code class="docutils literal notranslate"><span class="pre">corr</span></code> (for correction). For simplicity, locations where the factor of safety is lower than 1 get <span class="math notranslate nohighlight">\(h=0\)</span> (method <code class="docutils literal notranslate"><span class="pre">remove_unstable</span></code>). <span class="math notranslate nohighlight">\(h_w(x,y)\)</span> will be allowed to vary in the next tutorial (during rainstorms).</p>
<p>The <strong>natural land layer</strong> (parameterized in <code class="docutils literal notranslate"><span class="pre">natLandPar</span></code>) is defined by the state <span class="math notranslate nohighlight">\(S(x,y)\)</span>, with <span class="math notranslate nohighlight">\(S = -1\)</span> (water) for <span class="math notranslate nohighlight">\(z(x,y)&lt;0\)</span> (west of coastline) and at the coordinates of the river channel(s), <span class="math notranslate nohighlight">\(S = 0\)</span> (grassland) for <span class="math notranslate nohighlight">\(z\)</span> greater than <code class="docutils literal notranslate"><span class="pre">ve_treeline_m</span></code>, and <span class="math notranslate nohighlight">\(S = 1\)</span> (forest) otherwise (<code class="docutils literal notranslate"><span class="pre">ve</span></code> for vegetation). This layer can be considered a sublayer of the land use layer to be defined in Section 2, with the state updated there where urbanized.</p>
<p>Note that an <code class="docutils literal notranslate"><span class="pre">atmoPar</span></code> dictionary is already defined in view of a future environmental layer to describe the atmosphere (which will later include temperature and water vapor on top of pressure <code class="docutils literal notranslate"><span class="pre">pn_mbar</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">topoPar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;lores_f&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;bg_tan(phi)&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span>
    <span class="s1">&#39;th&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;th_Dz_km&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">.5</span><span class="p">,</span>
    <span class="s1">&#39;vo&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;vo_w_km&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="s1">&#39;vo_h_km&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="s1">&#39;fr&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;fr_Df&#39;</span><span class="p">:</span> <span class="mf">2.6</span><span class="p">,</span> <span class="s1">&#39;fr_eta&#39;</span><span class="p">:</span> <span class="mf">.5</span><span class="p">,</span> <span class="s1">&#39;fr_seed&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;rv&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;rv_tan(phiWE)&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">1000</span><span class="p">],</span> <span class="s1">&#39;rv_tan(phiNS)&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;rv_eta&#39;</span><span class="p">:</span> <span class="mf">.1</span><span class="p">,</span>
    <span class="s1">&#39;cs&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;cs_w_km&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;cs_tan(phi)&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;cs_eta&#39;</span><span class="p">:</span> <span class="mf">.1</span><span class="p">,</span>
    <span class="s1">&#39;plt_zmin_m&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;plt_zmax_m&#39;</span><span class="p">:</span> <span class="mi">4500</span>
<span class="p">}</span>
<span class="n">soilPar</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;h0_m&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;wat_h_m&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
           <span class="s1">&#39;Ceff_Pa&#39;</span><span class="p">:</span> <span class="mf">20e3</span><span class="p">,</span> <span class="s1">&#39;phieff_deg&#39;</span><span class="p">:</span> <span class="mi">27</span><span class="p">,</span> <span class="s1">&#39;rho_kg/m3&#39;</span><span class="p">:</span> <span class="mi">2650</span><span class="p">,</span>
           <span class="s1">&#39;corr&#39;</span><span class="p">:</span> <span class="s1">&#39;remove_unstable&#39;</span><span class="p">}</span>
<span class="n">natLandPar</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ve_treeline_m&#39;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">}</span>
<span class="n">atmoPar</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rho_kg/m3&#39;</span><span class="p">:</span> <span class="mf">1.15</span><span class="p">,</span> <span class="s1">&#39;pn_mbar&#39;</span><span class="p">:</span> <span class="mi">1005</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>We will build all the natural environmental layers at once. Notice that each new layer builds upon the characteristics of the previous one(s).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">GenMR_env</span><span class="o">.</span><span class="n">RasterGrid</span><span class="p">(</span><span class="n">gridPar</span><span class="p">)</span>
<span class="n">topoLayer</span> <span class="o">=</span> <span class="n">GenMR_env</span><span class="o">.</span><span class="n">EnvLayer_topo</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">topoPar</span><span class="p">)</span>
<span class="n">soilLayer</span> <span class="o">=</span> <span class="n">GenMR_env</span><span class="o">.</span><span class="n">EnvLayer_soil</span><span class="p">(</span><span class="n">topoLayer</span><span class="p">,</span> <span class="n">soilPar</span><span class="p">)</span>
<span class="n">natLandLayer</span> <span class="o">=</span> <span class="n">GenMR_env</span><span class="o">.</span><span class="n">EnvLayer_natLand</span><span class="p">(</span><span class="n">soilLayer</span><span class="p">,</span> <span class="n">natLandPar</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/arnaudmignan/Documents/GmbH_MRA/2_fundedR&amp;D/2025-2027_GenMR_SCOR/GenMR_SCOR/GenMR/environment.py:460: RuntimeWarning: invalid value encountered in sqrt
  zth_tmp = Pe * np.sqrt(1 - (x_rot-xc_rot)**2/Le**2 - (y_rot-yc_rot)**2/We**2) +zc[seg]
</pre></div>
</div>
</div>
</div>
<p>We can already save the parameter sets and environmental layers (in folder <code class="docutils literal notranslate"><span class="pre">io/</span></code>) for later use:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">GenMR_utils</span><span class="o">.</span><span class="n">save_class2pickle</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;src&#39;</span><span class="p">)</span>
<span class="n">GenMR_utils</span><span class="o">.</span><span class="n">save_class2pickle</span><span class="p">(</span><span class="n">topoLayer</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;envLayer_topo&#39;</span><span class="p">)</span>
<span class="n">GenMR_utils</span><span class="o">.</span><span class="n">save_class2pickle</span><span class="p">(</span><span class="n">soilLayer</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;envLayer_soil&#39;</span><span class="p">)</span>
<span class="n">GenMR_utils</span><span class="o">.</span><span class="n">save_class2pickle</span><span class="p">(</span><span class="n">natLandLayer</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;envLayer_natLand&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="environmental-layer-properties-and-attribute-plotting">
<h3>1.4. Environmental layer properties (and attribute plotting)<a class="headerlink" href="#environmental-layer-properties-and-attribute-plotting" title="Link to this heading"></a></h3>
<p>Environmental layers can have built-in properties (Tab. 1). The function <code class="docutils literal notranslate"><span class="pre">plot_EnvLayers()</span></code> plots each environmental layer and its main properties (when the argument <code class="docutils literal notranslate"><span class="pre">file_ext</span></code> is filled with <code class="docutils literal notranslate"><span class="pre">jpg</span></code>, <code class="docutils literal notranslate"><span class="pre">pdf</span></code> or other formats accepted by <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot.savefig</span></code>, a file is created in the folder <code class="docutils literal notranslate"><span class="pre">figs/</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">GenMR_env</span><span class="o">.</span><span class="n">plot_EnvLayers</span><span class="p">([</span><span class="n">topoLayer</span><span class="p">,</span> <span class="n">soilLayer</span><span class="p">,</span> <span class="n">natLandLayer</span><span class="p">],</span> <span class="n">file_ext</span> <span class="o">=</span> <span class="s1">&#39;jpg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/arnaudmignan/Documents/GmbH_MRA/2_fundedR&amp;D/2025-2027_GenMR_SCOR/GenMR_SCOR/GenMR/environment.py:605: RuntimeWarning: divide by zero encountered in divide
  FS = (par[&#39;Ceff_Pa&#39;] / (par[&#39;rho_kg/m3&#39;] * GenMR_utils.g_earth * h) + np.cos(slope * np.pi/180) * \
</pre></div>
</div>
<img alt="../_images/b4afed5ae0ce10e1c70156ba5e055885973d1ff62a881d596f49408a732a8ff6.png" src="../_images/b4afed5ae0ce10e1c70156ba5e055885973d1ff62a881d596f49408a732a8ff6.png" />
</div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">plot_EnvLayer_attr()</span></code> plots individual attributes (incl. properties) from environmental layers. If the elevation is given in the argument <code class="docutils literal notranslate"><span class="pre">hillshading_z</span></code>, hill shading is added in the background.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">GenMR_env</span><span class="o">.</span><span class="n">plot_EnvLayer_attr</span><span class="p">(</span><span class="n">topoLayer</span><span class="p">,</span> <span class="s1">&#39;aspect&#39;</span><span class="p">,</span> <span class="n">file_ext</span> <span class="o">=</span> <span class="s1">&#39;jpg&#39;</span><span class="p">)</span>
<span class="n">GenMR_env</span><span class="o">.</span><span class="n">plot_EnvLayer_attr</span><span class="p">(</span><span class="n">soilLayer</span><span class="p">,</span> <span class="s1">&#39;FS&#39;</span><span class="p">)</span>
<span class="n">GenMR_env</span><span class="o">.</span><span class="n">plot_EnvLayer_attr</span><span class="p">(</span><span class="n">soilLayer</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">hillshading_z</span> <span class="o">=</span> <span class="n">topoLayer</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/arnaudmignan/Documents/GmbH_MRA/2_fundedR&amp;D/2025-2027_GenMR_SCOR/GenMR_SCOR/GenMR/environment.py:605: RuntimeWarning: divide by zero encountered in divide
  FS = (par[&#39;Ceff_Pa&#39;] / (par[&#39;rho_kg/m3&#39;] * GenMR_utils.g_earth * h) + np.cos(slope * np.pi/180) * \
</pre></div>
</div>
<img alt="../_images/70464cb38d9485ae80f0f6fcfb4cf7558ffcfac11a3f55e06464a4332b9f1867.png" src="../_images/70464cb38d9485ae80f0f6fcfb4cf7558ffcfac11a3f55e06464a4332b9f1867.png" />
<img alt="../_images/aec82bf6a793f3ca958a31564ab42ba6ae23df9d44045b6d5f33e8d564916437.png" src="../_images/aec82bf6a793f3ca958a31564ab42ba6ae23df9d44045b6d5f33e8d564916437.png" />
<img alt="../_images/763ae87923a87fd37faeeb07be528d589300d2b8823f3f0122ddb868e1b30350.png" src="../_images/763ae87923a87fd37faeeb07be528d589300d2b8823f3f0122ddb868e1b30350.png" />
</div>
</div>
</section>
<section id="a-note-on-environmental-layer-downscaling">
<h3>1.5. A note on environmental layer downscaling<a class="headerlink" href="#a-note-on-environmental-layer-downscaling" title="Link to this heading"></a></h3>
<p>Different environmental processes may occur at different scales. The default resolution is defined by the pixel width <code class="docutils literal notranslate"><span class="pre">gridPar['w']</span></code>, which represents the finest one possible for environmental layers. A grid class instance can be downscaled with the function <code class="docutils literal notranslate"><span class="pre">downscale_RasterGrid()</span></code>. This was for example used to generate the topography (in <code class="docutils literal notranslate"><span class="pre">EnvLayer_topo()</span></code>). Another process defined at lower resolution will be the road network in Section 2 which will required downscaled terrain slope and water mask as inputs. Different pooling methods (min, mean or max) are available in function <code class="docutils literal notranslate"><span class="pre">pooling()</span></code>. This is illustrated below with the resolution reduced by a factor <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">=</span> <span class="pre">50</span></code> to emphasize the impact on the layers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">grid_downscaled</span> <span class="o">=</span> <span class="n">GenMR_env</span><span class="o">.</span><span class="n">downscale_RasterGrid</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">appl</span> <span class="o">=</span> <span class="s1">&#39;pooling&#39;</span><span class="p">)</span>
<span class="n">topoLayer_downscaled</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">topoLayer</span><span class="p">)</span>
<span class="n">topoLayer_downscaled</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid_downscaled</span>
<span class="n">topoLayer_downscaled</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">GenMR_utils</span><span class="o">.</span><span class="n">pooling</span><span class="p">(</span><span class="n">topoLayer</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span><span class="p">)</span>             <span class="c1"># mean-pooling example</span>

<span class="n">GenMR_env</span><span class="o">.</span><span class="n">plot_EnvLayers</span><span class="p">([</span><span class="n">topoLayer_downscaled</span><span class="p">])</span>    <span class="c1"># notice that properties are automatically recomputed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0fce340264863da8766c12047e6dd41227a0a85ac2c939cf7c349c3c77c2fb91.png" src="../_images/0fce340264863da8766c12047e6dd41227a0a85ac2c939cf7c349c3c77c2fb91.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">natLandLayer_downscaled</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">natLandLayer</span><span class="p">)</span>
<span class="n">natLandLayer_downscaled</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid_downscaled</span>
<span class="n">natLandLayer_downscaled</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">GenMR_utils</span><span class="o">.</span><span class="n">pooling</span><span class="p">(</span><span class="n">natLandLayer</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s1">&#39;min&#39;</span><span class="p">)</span>        <span class="c1"># min-pooling example</span>

<span class="n">GenMR_env</span><span class="o">.</span><span class="n">plot_EnvLayer_attr</span><span class="p">(</span><span class="n">natLandLayer_downscaled</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/663f3b3dd16c3f05a62781c0a304e5c2a24d09beda7acfecace5fd222d0b80f0.png" src="../_images/663f3b3dd16c3f05a62781c0a304e5c2a24d09beda7acfecace5fd222d0b80f0.png" />
</div>
</div>
</section>
</section>
<section id="technological-environment-generation">
<h2>2. Technological environment generation<a class="headerlink" href="#technological-environment-generation" title="Link to this heading"></a></h2>
<p>The technological system refers to all things produced by humans. This includes the built environment and critical infrastructures (transportation network, energy production and distribution). Goods and services (via businesses) will be defined in the socio-economic system.</p>
<section id="generating-the-urban-land-layer-and-road-network-object">
<h3>2.1. Generating the urban land layer (and road network object)<a class="headerlink" href="#generating-the-urban-land-layer-and-road-network-object" title="Link to this heading"></a></h3>
<p>The <em>urban land layer</em> (parameterized in <code class="docutils literal notranslate"><span class="pre">urbLandPar</span></code>) updates the natural land layer by urbanising grid pixels with new states <span class="math notranslate nohighlight">\(S = 2\)</span> for residential, <span class="math notranslate nohighlight">\(S = 3\)</span> for industrial and <span class="math notranslate nohighlight">\(S = 4\)</span> for commercial. The city nucleates at <code class="docutils literal notranslate"><span class="pre">city_seed</span></code><span class="math notranslate nohighlight">\((x,y)\)</span> and grows for a period <code class="docutils literal notranslate"><span class="pre">city_yrs</span></code> by following the main rules of the SLEUTH CA (Clarke et al., 1997; Candau et al., 2002; Candau, 2002) parameterized by <code class="docutils literal notranslate"><span class="pre">SLEUTH_*</span></code>. Each year, the city develops constrained on the road network configuration (an environmental object in the digital template) that grows in parallel to the city, and which is also based on a CA (Koenig &amp; Bauriedel, 2009) with parameters <code class="docutils literal notranslate"><span class="pre">road_*</span></code>. After each built per simulation-year, built grid pixels get their state <span class="math notranslate nohighlight">\(S\)</span> following the land-use transformation function of White et al. (1997:tab.1). The full description of this hybrid city-generator will be given in a future article (Mignan, in prep. - See also Mignan, 2024:boxes 3.1-3.3).</p>
<div class="alert alert-block alert-info"> <b>On the SLEUTH model</b><br>
Please note that the SLEUTH algorithm used for <code>GenMR</code> was developed from the modelling instructions provided in Clarke et al. (1997), Candau et al. (2002) and Candau (2002) to gain knowledge on the general process of city growth. It is therefore likely that the code differs in many ways from the official SLEUTH urban growth model. Consider using <code><a href="https://pypi.org/project/sleuth-automation/" target="_blank">sleuth-automation</a></code> for any dedicated SLEUTH model use. The class <code>GenMR.environment.EnvLayer_landUrb()</code> includes a road network CA within the SLEUTH loop and adds the land use transformation function of White et al. (1997) instead of the SLEUTH Deltatron at the end of each year-run.</div>
<p>Depending on the parameterization (especially on the value of <code class="docutils literal notranslate"><span class="pre">city_yrs</span></code>), the city generation may take more than a few minutes! (possibly half an hour for a 100-year built). To expedite the process, the user could directly load the saved default <code class="docutils literal notranslate"><span class="pre">urbLandLayer</span></code> class instance by fixing <code class="docutils literal notranslate"><span class="pre">file_urbLandLayer</span> <span class="pre">=</span> <span class="pre">'envLayer_natLand_default.pkl'</span></code> below.</p>
<p>For economic loss assessment in the next notebooks, additional attributes are defined per building block, function of the occupancy class. Four generic building materials <code class="docutils literal notranslate"><span class="pre">bldg_type</span></code> are considered: Wood (W), masonry (M), reinforced concrete (RC) and steel (S). Building value <code class="docutils literal notranslate"><span class="pre">bldg_value</span></code> is estimated as a function of GDP per capita (see parameter <code class="docutils literal notranslate"><span class="pre">GPD_percapita_USD</span></code>) following the power-law</p>
<p><span class="math notranslate nohighlight">\(C = c_1 V^{c_2}\)</span></p>
<p>where <span class="math notranslate nohighlight">\(C\)</span> is the building construction cost and <span class="math notranslate nohighlight">\(V\)</span> the GDP per capita (assuming parity between USD and EUR). Empirical parameters <span class="math notranslate nohighlight">\(c_1\)</span> and <span class="math notranslate nohighlight">\(c_2\)</span> are obtained from Huizinga et al. (2017). For different occupancy classes, we have:</p>
<ul class="simple">
<li><p>Residential: Wood (W) or masonry (M) depending on the ratio <code class="docutils literal notranslate"><span class="pre">bldg_res_wood2brick</span></code>, <span class="math notranslate nohighlight">\(c_1 = 24.1\)</span> and <span class="math notranslate nohighlight">\(c_2 = 0.385\)</span>;</p></li>
<li><p>Commercial: Reinforced concrete (RC), <span class="math notranslate nohighlight">\(c_1 = 33.6\)</span> and <span class="math notranslate nohighlight">\(c_2 = 0.357\)</span>;</p></li>
<li><p>Industrial: Steel (S), <span class="math notranslate nohighlight">\(c_1 = 30.8\)</span> and <span class="math notranslate nohighlight">\(c_2 = 0.325\)</span>.</p></li>
</ul>
<p>-&gt; ADD a modifying factor with distance from city center (or built year)…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">file_urbLandLayer</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>           <span class="c1"># run the city growth model if &#39;&#39; provided</span>
<span class="c1">#file_urbLandLayer = &#39;envLayer_urbLand.pkl&#39;</span>

<span class="n">urbLandPar</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;lores_f&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;rdm_seed&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="c1"># seed does not work -&gt; find where to put it...</span>
    <span class="s1">&#39;city_seed&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">40.5</span><span class="p">,</span><span class="mf">20.5</span><span class="p">],</span>     <span class="c1"># coordinates of city seed centre (put near river as historical centre)</span>
    <span class="s1">&#39;city_yr0&#39;</span><span class="p">:</span> <span class="mi">1900</span><span class="p">,</span>             <span class="c1"># year of settlement creation</span>
    <span class="s1">&#39;city_yrs&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>              <span class="c1"># number of years for urban growth from seed</span>
    <span class="s1">&#39;SLEUTH_maxslope&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>        <span class="c1"># cannot build above (degree) - Candau &amp; Rasmussen (2000:2)</span>
    <span class="s1">&#39;SLEUTH_disp&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>            <span class="c1"># dispersion coefficient</span>
    <span class="s1">&#39;SLEUTH_breed&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>           <span class="c1"># breed coefficient</span>
    <span class="s1">&#39;SLEUTH_spread&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>          <span class="c1"># spread coefficient</span>
    <span class="s1">&#39;SLEUTH_slope&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
    <span class="s1">&#39;SLEUTH_roadg&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>            <span class="c1"># road gravity</span>
    <span class="s1">&#39;road_growth&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>             <span class="c1"># number of road network nodes generated per year</span>
    <span class="s1">&#39;road_Rmax&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>               <span class="c1"># max. radius in terms of number of perpendicular cells</span>
    <span class="s1">&#39;road_maxslope&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>          <span class="c1"># cannot build above (degree)</span>
    <span class="s1">&#39;road_X&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>                  <span class="c1"># </span>
    <span class="s1">&#39;bldg_res_wood2brick&#39;</span><span class="p">:</span> <span class="mf">.5</span><span class="p">,</span>    <span class="c1"># ratio of number of res. blocks made of wood relative to bricks (masonry)</span>
    <span class="s1">&#39;GPD_percapita_USD&#39;</span><span class="p">:</span> <span class="mf">40e3</span>     <span class="c1"># GDP per capita (USD) used to estimate construction cost for res, com, ind.</span>
<span class="p">}</span>
<span class="n">GenMR_utils</span><span class="o">.</span><span class="n">save_dict2json</span><span class="p">(</span><span class="n">urbLandPar</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;par_urbLand&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_urbLandLayer</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">urbLandLayer</span> <span class="o">=</span> <span class="n">GenMR_utils</span><span class="o">.</span><span class="n">load_pickle2class</span><span class="p">(</span><span class="s1">&#39;/io/&#39;</span> <span class="o">+</span> <span class="n">file_urbLandLayer</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;... urbLandLayer class instance loaded&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">urbLandLayer</span> <span class="o">=</span> <span class="n">GenMR_env</span><span class="o">.</span><span class="n">EnvLayer_urbLand</span><span class="p">(</span><span class="n">natLandLayer</span><span class="p">,</span> <span class="n">urbLandPar</span><span class="p">)</span>   <span class="c1"># init city instance</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">urbLandPar</span><span class="p">[</span><span class="s1">&#39;city_yrs&#39;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">urbLandLayer</span><span class="o">.</span><span class="n">built</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
        <span class="nb">next</span><span class="p">(</span><span class="n">urbLandLayer</span><span class="p">)</span>   
    <span class="n">GenMR_utils</span><span class="o">.</span><span class="n">save_class2pickle</span><span class="p">(</span><span class="n">urbLandLayer</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;envLayer_urbLand&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 1
10 2716
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/arnaudmignan/Documents/GmbH_MRA/2_fundedR&amp;D/2025-2027_GenMR_SCOR/GenMR_SCOR/GenMR/environment.py:990: RuntimeWarning: invalid value encountered in scalar power
  pr = ((par[&#39;SLEUTH_maxslope&#39;] - np.round(slope)) / par[&#39;SLEUTH_maxslope&#39;])**expo
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20 7785
30 15216
40 24844
50 36578
60 49865
70 62504
80 73050
90 82763
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">urbLandLayer</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;GenMR.environment.EnvLayer_urbLand at 0x16dcc7390&gt;
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../manual.html" class="btn btn-neutral float-left" title="Reference manual" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Arnaud Mignan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>